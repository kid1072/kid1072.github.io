<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>星海引路人 - 拓客社团ME部门招新游戏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // 配置Tailwind自定义颜色
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#89A707',
                        secondary: '#FFCA00',
                        neutral: '#E4EAE7',
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
        }
    </style>
</head>
<body class="bg-white font-sans text-gray-800">
    <div id="game-container" class="max-w-md mx-4 mx-auto bg-white p-6 rounded-xl shadow-lg mt-4 mb-8">
        <!-- 标题页 -->
        <div id="title-screen" class="text-center py-6">
            <div class="w-20 h-20 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa fa-star text-white text-3xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">星海引路人</h1>
            <p class="text-gray-600 mb-8">拓客社团ME关爱教育部门招新互动游戏</p>
            <button id="start-btn" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-8 rounded-lg transition duration-300 transform hover:scale-105">
                开始游戏 <i class="fa fa-arrow-right ml-2 text-white"></i>
            </button>
        </div>

        <!-- 游戏主界面 -->
        <div id="game-screen" class="hidden rounded-lg p-4">
            <div class="mb-4 pb-4 border-b border-primary/20">
                <div class="flex items-center text-sm text-gray-500 mb-2">
                    <i class="fa fa-map-marker mr-2"></i>
                    <span id="progress-indicator">当前进度</span>
                </div>
                <div id="scene-container" class="text-lg leading-relaxed"></div>
            </div>
            <div id="choices-container" class="space-y-3"></div>
        </div>

        <!-- 结局页 -->
        <div id="ending-screen" class="hidden">
            <div id="screenshot-container">
                <!-- 用于生成分享图片的容器 -->
                <div id="share-image-container" class="bg-white rounded-xl p-6 mb-6">
                    <div class="w-20 h-20 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-star text-white text-3xl"></i>
                    </div>
                    <h2 id="ending-title" class="text-2xl font-bold mb-4 text-center"></h2>
                    <p id="ending-desc" class="text-gray-700 mb-6 leading-relaxed"></p>
                    <p id="ending-relation" class="font-semibold text-primary mb-6 text-center"></p>
                    <div class="text-center text-sm text-gray-500 mt-6 pt-4 border-t border-gray-200">
                        来自拓客社团「星海引路人」ME部门招新游戏
                    </div>
                </div>

                <!-- 招新说明部分 -->
                <div class="bg-neutral p-5 rounded-lg mb-6">
                    <h3 class="text-xl font-bold text-primary mb-3">关于 ME 关爱教育部门</h3>
                    <p class="text-gray-700 mb-3">
                        我们关注偏远地区、少数群体、社会边缘群体的教育发展和身心健康，致力于改善社会资源不均的现状。通过线上陪伴指导（如蓝信封、太阳语、星云计划等）和线下支教，让更多孩子感受到教育与陪伴的力量。
                    </p>
                    <p class="text-gray-700 italic mb-4">
                        "我们相信：用一棵树摇动另一棵树，用一朵云推动另一朵云，用一个灵魂唤醒另一个灵魂。"
                    </p>
                    <p class="text-primary font-bold mb-4">期待你的加入！</p>

                    <!-- 招新推送链接按钮 -->
                    <a href="https://example.com/me-recruitment" target="_blank" class="inline-block bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                        <i class="fa fa-link mr-2"></i> 查看招新详情
                    </a>
                </div>
            </div>

            <!-- 分享按钮 -->
            <button id="share-btn" class="w-full bg-secondary hover:bg-secondary/90 text-gray-800 font-medium py-3 px-4 rounded-lg transition duration-300 mb-3">
                <i class="fa fa-share-alt mr-2"></i> 保存结果图片
            </button>
            <p class="text-xs text-gray-500 text-center mt-0 mb-3">
                若无法保存，请尝试截图
            </p>
            <button id="restart-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition duration-300">
                <i class="fa fa-refresh mr-2"></i> 重新开始
            </button>
        </div>
    </div>

    <script>
        // --- 游戏核心逻辑 ---
        const gameData = {
            scenes: {
                start: {
                    text: "你是一名新晋志愿者，代号“引路人-9”。请选择你将参与的项目：",
                    choices: [
                        { text: "【星云计划】民族文化与自然探索", next: "nebula_1", path: "A" },
                        { text: "【蓝信封】书信陪伴留守儿童", next: "blueletter_1", path: "B" },
                        { text: "【太阳语】罕见病儿童辅导与陪伴", next: "sunshine_1", path: "C" }
                    ]
                },
                // 星云计划分支 (A)
                nebula_1: {
                    text: "你的学生小依对民族文化很感兴趣，但她的父母希望她把更多时间用在数学上。",
                    choices: [
                        { text: "坚持文化课程，设计“民族故事+数学”项目。", next: "nebula_2", path: "A1" },
                        { text: "先转向数学辅导，再寻找结合点。", next: "nebula_3", path: "A2" }
                    ]
                },
                nebula_2: {
                    text: "项目进展顺利，但父母认为是“不务正业”，要求暂停。",
                    choices: [
                        { text: "据理力争，展示项目对综合能力的提升。", next: "nebula_4", path: "A1a" },
                        { text: "寻求折中，改为每周一次的兴趣拓展。", next: "nebula_5", path: "A1b" }
                    ]
                },
                nebula_3: {
                    text: "你帮小依补了几周数学，她成绩有所提升，但对课程的热情不高。",
                    choices: [
                        { text: "继续强化数学，并尝试在题目中融入文化元素。", next: "nebula_6", path: "A2a" },
                        { text: "尊重她的兴趣，和家长沟通恢复文化课程。", next: "nebula_7", path: "A2b" }
                    ]
                },
                nebula_4: {
                    text: "家长态度强硬，甚至向项目负责人投诉你不按要求教学。",
                    choices: [
                        { text: "邀请负责人观摩课程，展示教学效果。", next: "nebula_8", path: "A1a1" },
                        { text: "暂时妥协，同时收集学生进步的证据。", next: "nebula_9", path: "A1a2" }
                    ]
                },
                nebula_5: {
                    text: "小依很珍惜每周一次的文化课程，但你发现她在课堂上越来越沉默。",
                    choices: [
                        { text: "课后单独和她交流，了解她的想法。", next: "nebula_10", path: "A1b1" },
                        { text: "增加课程趣味性，引入更多互动环节。", next: "nebula_11", path: "A1b2" }
                    ]
                },
                nebula_6: {
                    text: "小依的数学成绩持续提升，但你发现她偷偷在笔记本上画民族服饰。",
                    choices: [
                        { text: "肯定她的绘画，鼓励她创作与数学结合的作品。", next: "nebula_12", path: "A2a1" },
                        { text: "假装没看见，继续按计划完成数学教学。", next: "nebula_13", path: "A2a2" }
                    ]
                },
                nebula_7: {
                    text: "家长勉强同意恢复文化课程，但要求你保证不影响数学成绩。",
                    choices: [
                        { text: "制定双轨学习计划，明确学习目标和评估方式。", next: "nebula_14", path: "A2b1" },
                        { text: "先口头答应，后续用实际成果证明不冲突。", next: "nebula_15", path: "A2b2" }
                    ]
                },
                nebula_8: {
                    text: "负责人观摩后认可了你的教学理念，但建议你加强与家长的沟通方式。",
                    choices: [
                        { text: "定期向家长发送学习报告，展示综合能力提升。", next: "ending_A_success", path: "A1a1a" },
                        { text: "邀请家长参与部分课程，亲身体验教学效果。", next: "ending_A_excellent", path: "A1a1b" }
                    ]
                },
                nebula_9: {
                    text: "你收集了小依的作业和课堂表现，发现她的逻辑思维能力明显提升。",
                    choices: [
                        { text: "用数据说服家长，申请恢复原教学计划。", next: "ending_A_success", path: "A1a2a" },
                        { text: "设计更平衡的课程方案，争取家长支持。", next: "ending_A_compromise", path: "A1a2b" }
                    ]
                },
                nebula_10: {
                    text: "小依告诉你，她担心表现不好会失去这唯一的文化课程机会。",
                    choices: [
                        { text: "和她一起制定小目标，减轻心理压力。", next: "ending_good_teacher", path: "A1b1a" },
                        { text: "与家长沟通，强调兴趣对学习的积极影响。", next: "nebula_16", path: "A1b1b" }
                    ]
                },
                nebula_11: {
                    text: "新的互动环节很受欢迎，小依逐渐活跃起来，但教学进度变慢了。",
                    choices: [
                        { text: "保证质量，适当延长课程周期。", next: "ending_A_success", path: "A1b2a" },
                        { text: "优化内容，在趣味性和进度间找平衡。", next: "ending_A_compromise", path: "A1b2b" }
                    ]
                },
                nebula_12: {
                    text: "小依创作了一组以民族图案为主题的几何画作，获得了学校的表扬。",
                    choices: [
                        { text: "鼓励她参加民族文化创意比赛。", next: "ending_A_excellent", path: "A2a1a" },
                        { text: "将作品展示给家长，证明兴趣与学习的结合。", next: "ending_A_success", path: "A2a1b" }
                    ]
                },
                nebula_13: {
                    text: "小依的数学成绩名列前茅，但她的笔记本被父母发现，要求没收。",
                    choices: [
                        { text: "介入调解，建议设立“学习奖励时间”用于兴趣发展。", next: "ending_missed_opportunity", path: "A2a2a" },
                        { text: "尊重家长决定，课后帮她保留创作空间。", next: "ending_good_teacher", path: "A2a2b" }
                    ]
                },
                nebula_14: {
                    text: "双轨计划实施顺利，小依的数学成绩稳定，文化学习也很投入。",
                    choices: [
                        { text: "邀请她担任小老师，帮助其他同学。", next: "ending_A_excellent", path: "A2b1a" },
                        { text: "按计划完成学期内容，总结经验推广。", next: "ending_A_success", path: "A2b1b" }
                    ]
                },
                nebula_15: {
                    text: "小依在期末考试中数学进步明显，文化知识也更加丰富。",
                    choices: [
                        { text: "组织小型成果展示会，邀请家长参加。", next: "ending_A_success", path: "A2b2a" },
                        { text: "让小依向家长汇报收获，自己补充说明。", next: "ending_A_compromise", path: "A2b2b" }
                    ]
                },
                nebula_16: {
                    text: "家长态度有所松动，同意增加文化课程频率，但要求你提供更系统的教学方案。",
                    choices: [
                        { text: "制定详细的课程大纲和评估标准。", next: "ending_A_success", path: "A1b1b1" },
                        { text: "邀请家长参与课程设计，共同制定方案。", next: "ending_A_excellent", path: "A1b1b2" }
                    ]
                },
                
                // 蓝信封分支 (B)
                blueletter_1: {
                    text: "通信伙伴阿木在信中提到他很迷茫，觉得读书没有用。",
                    choices: [
                        { text: "分享你的大学生活与困惑，告诉他探索的价值。", next: "blueletter_2", path: "B1" },
                        { text: "提供实际建议，鼓励他探索职业方向。", next: "blueletter_3", path: "B2" }
                    ]
                },
                blueletter_2: {
                    text: "阿木回信说你的分享让他很受触动，但家里希望他早点打工补贴家用。",
                    choices: [
                        { text: "鼓励他坚持学业，强调长期价值。", next: "blueletter_4", path: "B1a" },
                        { text: "理解他的家庭压力，探讨半工半读等可能性。", next: "blueletter_5", path: "B1b" }
                    ]
                },
                blueletter_3: {
                    text: "阿木采纳了你的建议，但在后续信件中，他提到自己感到孤独。",
                    choices: [
                        { text: "增加通信频率，更多地倾听和陪伴他。", next: "blueletter_6", path: "B2a" },
                        { text: "建议他多和身边的朋友、老师沟通。", next: "blueletter_7", path: "B2b" }
                    ]
                },
                blueletter_4: {
                    text: "阿木说他想继续读书，但担心自己基础太差跟不上。",
                    choices: [
                        { text: "帮他制定基础学习计划，逐步提升。", next: "blueletter_8", path: "B1a1" },
                        { text: "鼓励他不要怕起点低，分享自己克服困难的经历。", next: "blueletter_9", path: "B1a2" }
                    ]
                },
                blueletter_5: {
                    text: "阿木找到了一份周末兼职，但说工作很累，没时间写信了。",
                    choices: [
                        { text: "主动调整通信频率，减轻他的压力。", next: "blueletter_10", path: "B1b1" },
                        { text: "建议他合理安排时间，保持学习的连续性。", next: "blueletter_11", path: "B1b2" }
                    ]
                },
                blueletter_6: {
                    text: "你的频繁来信让阿木感受到了支持，但他开始依赖你的回复。",
                    choices: [
                        { text: "保持耐心，同时引导他建立自己的支持系统。", next: "blueletter_12", path: "B2a1" },
                        { text: "逐渐减少频率，鼓励他独立面对问题。", next: "blueletter_13", path: "B2a2" }
                    ]
                },
                blueletter_7: {
                    text: "阿木说他尝试和老师沟通，但感觉对方不理解他的处境。",
                    choices: [
                        { text: "教他一些沟通技巧，准备好具体问题再去交流。", next: "blueletter_14", path: "B2b1" },
                        { text: "建议他找学校的心理老师或信任的长辈倾诉。", next: "blueletter_15", path: "B2b2" }
                    ]
                },
                blueletter_8: {
                    text: "阿木按计划学习了一个月，有进步但不明显，有些灰心。",
                    choices: [
                        { text: "帮他分析原因，调整学习方法和目标。", next: "blueletter_16", path: "B1a1a" },
                        { text: "肯定他的努力，强调坚持的重要性。", next: "blueletter_17", path: "B1a1b" }
                    ]
                },
                blueletter_9: {
                    text: "你的经历鼓舞了阿木，他决定再试一个学期，但需要具体的学习帮助。",
                    choices: [
                        { text: "联系当地志愿者，为他提供线下辅导。", next: "blueletter_18", path: "B1a2a" },
                        { text: "自己利用业余时间准备学习资料寄给他。", next: "blueletter_19", path: "B1a2b" }
                    ]
                },
                blueletter_10: {
                    text: "你改为每月一封信，阿木回信说很想念以前的交流频率。",
                    choices: [
                        { text: "恢复每周通信，但缩短篇幅，减轻他的负担。", next: "blueletter_20", path: "B1b1a" },
                        { text: "保持每月一次，但内容更丰富，增加鼓励的话。", next: "blueletter_21", path: "B1b1b" }
                    ]
                },
                blueletter_11: {
                    text: "阿木尝试平衡工作和学习，但期中考试成绩下滑了。",
                    choices: [
                        { text: "建议他暂时减少工作时间，先稳住学习。", next: "blueletter_22", path: "B1b2a" },
                        { text: "帮他分析时间管理问题，优化日程安排。", next: "blueletter_23", path: "B1b2b" }
                    ]
                },
                blueletter_12: {
                    text: "在你的引导下，阿木开始和同学分享心事，人际关系有所改善。",
                    choices: [
                        { text: "鼓励他组织小型学习小组，共同进步。", next: "ending_B_success", path: "B2a1a" },
                        { text: "肯定他的成长，逐渐减少通信频率。", next: "ending_B_good", path: "B2a1b" }
                    ]
                },
                blueletter_13: {
                    text: "阿木对通信频率减少感到不安，担心你不再关心他。",
                    choices: [
                        { text: "解释原因，强调信任和他的成长，恢复适当频率。", next: "ending_B_success", path: "B2a2a" },
                        { text: "坚持减少频率，认为这是他独立的必经过程。", next: "ending_B_bittersweet", path: "B2a2b" }
                    ]
                },
                blueletter_14: {
                    text: "阿木用你教的方法和老师沟通，得到了一些实际帮助。",
                    choices: [
                        { text: "鼓励他总结经验，帮助其他有类似困扰的同学。", next: "ending_B_success", path: "B2b1a" },
                        { text: "继续支持他解决新出现的问题。", next: "ending_good_teacher", path: "B2b1b" }
                    ]
                },
                blueletter_15: {
                    text: "阿木找到了学校的心理老师，说感觉好多了，但仍想和你保持通信。",
                    choices: [
                        { text: "为他的进步高兴，调整通信内容为更轻松的话题。", next: "ending_B_success", path: "B2b2a" },
                        { text: "建议他逐渐独立，必要时再联系你。", next: "ending_B_good", path: "B2b2b" }
                    ]
                },
                blueletter_16: {
                    text: "调整方法后，阿木的学习效率提高了，他想报考县里的重点高中。",
                    choices: [
                        { text: "帮他收集备考资料和信息。", next: "ending_B_success", path: "B1a1a1" },
                        { text: "联系当地的学长学姐为他提供经验。", next: "ending_B_excellent", path: "B1a1a2" }
                    ]
                },
                blueletter_17: {
                    text: "阿木坚持学习，虽然进步缓慢，但从未放弃，他说你的鼓励是动力。",
                    choices: [
                        { text: "寄给他一份小礼物作为奖励和鼓励。", next: "ending_B_success", path: "B1a1b1" },
                        { text: "邀请他分享自己的坚持故事，鼓励更多人。", next: "ending_B_excellent", path: "B1a1b2" }
                    ]
                },
                blueletter_18: {
                    text: "当地志愿者开始帮助阿木，他的成绩有了明显提升。",
                    choices: [
                        { text: "与当地志愿者保持沟通，共同支持阿木。", next: "ending_B_success", path: "B1a2a1" },
                        { text: "逐渐退出，让阿木适应新的辅导模式。", next: "ending_good_teacher", path: "B1a2a2" }
                    ]
                },
                blueletter_19: {
                    text: "你寄的学习资料很受欢迎，阿木的同学也想借阅。",
                    choices: [
                        { text: "发动身边朋友一起收集资料，建立小型图书角。", next: "ending_B_excellent", path: "B1a2b1" },
                        { text: "指导阿木制作资料副本，与同学共享。", next: "ending_B_success", path: "B1a2b2" }
                    ]
                },
                blueletter_20: {
                    text: "恢复通信频率后，阿木状态很好，他说你的信是每周最期待的事。",
                    choices: [
                        { text: "保持这种模式直到学期结束。", next: "ending_B_success", path: "B1b1a1" },
                        { text: "慢慢引导他将这份期待转化为学习动力。", next: "ending_B_excellent", path: "B1b1a2" }
                    ]
                },
                blueletter_21: {
                    text: "你的长信让阿木感受到了持续的支持，他开始在信中分享自己的梦想。",
                    choices: [
                        { text: "帮他分析实现梦想的步骤和可能性。", next: "ending_B_success", path: "B1b1b1" },
                        { text: "鼓励他把梦想写下来，制定阶段性计划。", next: "ending_B_excellent", path: "B1b1b2" }
                    ]
                },
                blueletter_22: {
                    text: "阿木减少工作时间后，成绩回升，但家里经济压力增大。",
                    choices: [
                        { text: "帮助寻找更灵活且收入相当的兼职。", next: "ending_B_success", path: "B1b2a1" },
                        { text: "联系公益组织，申请助学补助。", next: "ending_B_excellent", path: "B1b2a2" }
                    ]
                },
                blueletter_23: {
                    text: "优化时间管理后，阿木能够平衡工作和学习，但非常疲惫。",
                    choices: [
                        { text: "建议他学习放松技巧，保证休息时间。", next: "ending_B_success", path: "B1b2b1" },
                        { text: "肯定他的努力，提醒他注意身体健康。", next: "ending_good_teacher", path: "B1b2b2" }
                    ]
                },

                // 太阳语分支 (C)
                sunshine_1: {
                    text: "学生小远因身体原因频繁请假，跟不上进度，感到非常沮丧。",
                    choices: [
                        { text: "调整目标，从建立自信入手，学习他感兴趣的内容。", next: "sunshine_2", path: "C1" },
                        { text: "提供情感支持，倾听他的感受并鼓励他接纳自己。", next: "sunshine_3", path: "C2" }
                    ]
                },
                sunshine_2: {
                    text: "小远在你的鼓励下，完成了一个他一直想做的小项目，重拾了自信。",
                    choices: [
                        { text: "将此作为新起点，设定更多他能完成的小目标。", next: "sunshine_4", path: "C1a" },
                        { text: "和他一起探索新的兴趣领域，保持学习的新鲜感。", next: "sunshine_5", path: "C1b" }
                    ]
                },
                sunshine_3: {
                    text: "小远向你敞开心扉，你也分享了如何调整心态面对困难。",
                    choices: [
                        { text: "推荐一些适合他的线上学习资源，帮助他自学。", next: "sunshine_6", path: "C2a" },
                        { text: "与项目组沟通，为他提供更灵活的辅导安排。", next: "sunshine_7", path: "C2b" }
                    ]
                },
                sunshine_4: {
                    text: "小远完成了几个小目标后，希望尝试更有挑战性的任务。",
                    choices: [
                        { text: "设计稍具难度但仍可完成的任务，逐步提升。", next: "sunshine_8", path: "C1a1" },
                        { text: "尊重他的决定，提供必要的支持和指导。", next: "sunshine_9", path: "C1a2" }
                    ]
                },
                sunshine_5: {
                    text: "你们一起探索了多个领域，小远对天文产生了浓厚兴趣。",
                    choices: [
                        { text: "帮助他深入学习天文知识，制定专题学习计划。", next: "sunshine_10", path: "C1b1" },
                        { text: "联系天文爱好者社群，让他获得更多交流机会。", next: "sunshine_11", path: "C1b2" }
                    ]
                },
                sunshine_6: {
                    text: "小远用你推荐的资源自学，但遇到难题时会感到挫败。",
                    choices: [
                        { text: "定期安排答疑时间，帮他解决难点。", next: "sunshine_12", path: "C2a1" },
                        { text: "教他如何寻找答案和求助的方法。", next: "sunshine_13", path: "C2a2" }
                    ]
                },
                sunshine_7: {
                    text: "项目组同意了灵活安排，但需要你提交详细的辅导计划。",
                    choices: [
                        { text: "与小远一起制定计划，尊重他的想法和节奏。", next: "sunshine_14", path: "C2b1" },
                        { text: "根据他的情况制定专业计划，再征求他的意见。", next: "sunshine_15", path: "C2b2" }
                    ]
                },
                sunshine_8: {
                    text: "小远在完成挑战性任务时遇到困难，情绪有些波动。",
                    choices: [
                        { text: "帮助他分解任务，降低难度，逐步完成。", next: "sunshine_16", path: "C1a1a" },
                        { text: "鼓励他坚持，相信他有能力克服困难。", next: "sunshine_17", path: "C1a1b" }
                    ]
                },
                sunshine_9: {
                    text: "小远选择的任务难度超出预期，多次尝试后仍未完成。",
                    choices: [
                        { text: "建议他调整目标，肯定他的努力和勇气。", next: "sunshine_18", path: "C1a2a" },
                        { text: "和他一起寻找新方法，不轻易放弃。", next: "sunshine_19", path: "C1a2b" }
                    ]
                },
                sunshine_10: {
                    text: "小远的天文知识日益丰富，他想制作一个小型天文观测报告。",
                    choices: [
                        { text: "指导他完成报告，并帮助他联系发表渠道。", next: "sunshine_20", path: "C1b1a" },
                        { text: "鼓励他将报告分享给其他同学，增强自信。", next: "sunshine_21", path: "C1b1b" }
                    ]
                },
                sunshine_11: {
                    text: "小远加入了天文社群，认识了许多有共同兴趣的朋友。",
                    choices: [
                        { text: "支持他参与社群活动，拓展社交圈。", next: "sunshine_22", path: "C1b2a" },
                        { text: "帮助他平衡线上交流和学习时间。", next: "sunshine_23", path: "C1b2b" }
                    ]
                },
                sunshine_12: {
                    text: "定期答疑帮助小远解决了困难，但他依赖你的程度也增加了。",
                    choices: [
                        { text: "逐渐减少答疑次数，培养他的独立思考能力。", next: "sunshine_24", path: "C2a1a" },
                        { text: "保持答疑频率，同时教他如何自主学习。", next: "sunshine_25", path: "C2a1b" }
                    ]
                },
                sunshine_13: {
                    text: "小远学会了自主解决问题，还帮助了其他有类似困难的同学。",
                    choices: [
                        { text: "鼓励他成为小老师，分享自己的学习方法。", next: "sunshine_26", path: "C2a2a" },
                        { text: "支持他继续深入学习，探索更多领域。", next: "sunshine_27", path: "C2a2b" }
                    ]
                },
                sunshine_14: {
                    text: "小远参与制定的计划执行顺利，他的学习主动性明显提高。",
                    choices: [
                        { text: "引导他制定长期学习目标，规划未来发展。", next: "sunshine_28", path: "C2b1a" },
                        { text: "保持现状，让他享受自主学习的乐趣。", next: "sunshine_29", path: "C2b1b" }
                    ]
                },
                sunshine_15: {
                    text: "小远对你制定的计划基本满意，但希望增加一些自己感兴趣的内容。",
                    choices: [
                        { text: "调整计划，融入他的兴趣点。", next: "sunshine_30", path: "C2b2a" },
                        { text: "解释计划的科学性，建议他在课余时间探索兴趣。", next: "sunshine_31", path: "C2b2b" }
                    ]
                },
                sunshine_16: {
                    text: "分解任务后，小远顺利完成了挑战，自信心大增。",
                    choices: [
                        { text: "鼓励他尝试更大的挑战，相信他的能力。", next: "ending_A_success", path: "C1a1a1" },
                        { text: "帮助他总结经验，为未来的挑战做准备。", next: "ending_good_teacher", path: "C1a1a2" }
                    ]
                },
                sunshine_17: {
                    text: "在你的鼓励下，小远坚持不懈，最终完成了任务，收获了成就感。",
                    choices: [
                        { text: "帮他记录这个过程，制作成纪念册。", next: "ending_A_success", path: "C1a1b1" },
                        { text: "邀请他分享自己的经历，鼓励其他同学。", next: "ending_A_excellent", path: "C1a1b2" }
                    ]
                },
                sunshine_18: {
                    text: "调整目标后，小远成功完成了任务，他学会了灵活面对困难。",
                    choices: [
                        { text: "肯定他的成长，讨论如何设定合理目标。", next: "ending_good_teacher", path: "C1a2a1" },
                        { text: "鼓励他以后遇到类似情况时，尝试自己调整。", next: "ending_independent_learner", path: "C1a2a2" }
                    ]
                },
                sunshine_19: {
                    text: "经过多次尝试和方法调整，小远终于完成了任务。",
                    choices: [
                        { text: "帮他总结成功经验，形成自己的解决问题模式。", next: "ending_independent_learner", path: "C1a2b1" },
                        { text: "庆祝他的成功，给予适当奖励。", next: "ending_A_success", path: "C1a2b2" }
                    ]
                },
                sunshine_20: {
                    text: "小远的天文报告获得了专业人士的肯定，他非常开心。",
                    choices: [
                        { text: "支持他继续深入研究，培养科研兴趣。", next: "ending_A_excellent", path: "C1b1a1" },
                        { text: "鼓励他将兴趣转化为学习动力，全面发展。", next: "ending_A_success", path: "C1b1a2" }
                    ]
                },
                sunshine_21: {
                    text: "小远的报告很受欢迎，同学们的认可让他更加自信。",
                    choices: [
                        { text: "帮助他准备更多分享内容，提升表达能力。", next: "ending_A_success", path: "C1b1b1" },
                        { text: "鼓励他组织小型天文兴趣小组，带动更多人。", next: "ending_A_excellent", path: "C1b1b2" }
                    ]
                },
                sunshine_22: {
                    text: "小远在社群中很活跃，甚至帮助解答其他成员的问题。",
                    choices: [
                        { text: "肯定他的贡献，鼓励他发挥领导力。", next: "ending_A_excellent", path: "C1b2a1" },
                        { text: "提醒他注意休息，保持适度参与。", next: "ending_good_teacher", path: "C1b2a2" }
                    ]
                },
                sunshine_23: {
                    text: "小远能够很好地平衡线上交流和学习，各方面都有进步。",
                    choices: [
                        { text: "鼓励他分享自己的时间管理方法。", next: "ending_independent_learner", path: "C1b2b1" },
                        { text: "帮他设定新的学习目标，继续提升。", next: "ending_A_success", path: "C1b2b2" }
                    ]
                },
                sunshine_24: {
                    text: "减少答疑后，小远虽然有些不适应，但逐渐学会了独立解决问题。",
                    choices: [
                        { text: "肯定他的进步，给予适当的奖励和鼓励。", next: "ending_independent_learner", path: "C2a1a1" },
                        { text: "与他讨论未来的学习计划，提供必要的指导。", next: "ending_good_teacher", path: "C2a1a2" }
                    ]
                },
                sunshine_25: {
                    text: "小远在保持答疑的同时，自主学习能力也在提升。",
                    choices: [
                        { text: "根据他的进步，逐步调整答疑方式和频率。", next: "ending_independent_learner", path: "C2a1b1" },
                        { text: "维持这种模式直到学期结束，确保学习效果。", next: "ending_good_teacher", path: "C2a1b2" }
                    ]
                },
                sunshine_26: {
                    text: "小远作为小老师很受欢迎，他在帮助别人的过程中也提升了自己。",
                    choices: [
                        { text: "支持他建立更系统的互助小组。", next: "ending_A_excellent", path: "C2a2a1" },
                        { text: "鼓励他记录教学经验，形成学习资料。", next: "ending_independent_learner", path: "C2a2a2" }
                    ]
                },
                sunshine_27: {
                    text: "小远探索了多个学习领域，找到了自己真正热爱的方向。",
                    choices: [
                        { text: "帮助他制定专业发展计划，深入学习。", next: "ending_independent_learner", path: "C2a2b1" },
                        { text: "联系相关领域的专业人士为他提供指导。", next: "ending_A_excellent", path: "C2a2b2" }
                    ]
                },
                sunshine_28: {
                    text: "小远有了明确的长期目标，学习动力更足了。",
                    choices: [
                        { text: "帮助他分解长期目标，制定阶段性计划。", next: "ending_independent_learner", path: "C2b1a1" },
                        { text: "鼓励他将目标分享给家人，获得更多支持。", next: "ending_A_success", path: "C2b1a2" }
                    ]
                },
                sunshine_29: {
                    text: "小远在自主学习中找到了乐趣，各方面能力均衡发展。",
                    choices: [
                        { text: "肯定他的学习状态，不做过多干预。", next: "ending_independent_learner", path: "C2b1b1" },
                        { text: "适时提供新的学习资源，拓展他的视野。", next: "ending_A_success", path: "C2b1b2" }
                    ]
                },
                sunshine_30: {
                    text: "融入兴趣点后，小远的学习积极性更高，效果也更好。",
                    choices: [
                        { text: "帮助他探索更多兴趣与学习结合的方法。", next: "ending_A_excellent", path: "C2b2a1" },
                        { text: "鼓励他总结这种学习模式，分享给其他同学。", next: "ending_A_success", path: "C2b2a2" }
                    ]
                },
                sunshine_31: {
                    text: "小远按计划学习，同时利用课余时间发展兴趣，状态很好。",
                    choices: [
                        { text: "肯定他的平衡能力，鼓励他继续保持。", next: "ending_good_teacher", path: "C2b2b1" },
                        { text: "建议他尝试将兴趣与学习内容结合，提高效率。", next: "ending_A_success", path: "C2b2b2" }
                    ]
                },

                // 结局部分
                ending_A_success: {
                    isEnding: true,
                    title: "【成功结局A：星尘之种】",
                    desc: "你成功地在孩子心中种下了希望的种子，让他在学习中找到了自信与乐趣。你用行动证明了教育不仅是知识的传递，更是心灵的滋养。",
                    relation: "适用于多个项目"
                },
                ending_A_excellent: {
                    isEnding: true,
                    title: "【隐藏结局A+：星海领航】",
                    desc: "你的教育方法不仅改变了一个孩子，更产生了积极的辐射效应。你用智慧和耐心点燃了更多心灵的火花，成为了真正的星海领航者。",
                    relation: "通用结局"
                },
                ending_A_compromise: {
                    isEnding: true,
                    title: "【普通结局：折中的守护】",
                    desc: "你守护了孩子的兴趣，虽然过程曲折，但你展现了强大的沟通能力和耐心。教育有时需要循序渐进，在妥协中寻找前进的空间。",
                    relation: "对应项目：【星云计划】"
                },
                ending_B_success: {
                    isEnding: true,
                    title: "【成功结局B：蓝信封的回信】",
                    desc: "你的陪伴成为了孩子生命中一束温暖的光，他在你的鼓励下找到了继续前行的勇气。最后一封信里，他画了一幅星星的画，说那是你。",
                    relation: "对应项目：【蓝信封书信陪伴】"
                },
                ending_B_good: {
                    isEnding: true,
                    title: "【普通结局B：持续的微光】",
                    desc: "你们的通信仍在继续，虽然没有惊天动地的改变，但这份持续的陪伴成为了孩子成长路上的稳定支持，温暖而坚定。",
                    relation: "对应项目：【蓝信封书信陪伴】"
                },
                ending_B_bittersweet: {
                    isEnding: true,
                    title: "【遗憾结局：现实的重量】",
                    desc: "你理解了现实的无奈，你们的通信虽已中断，但那份相互理解的温暖将长久留存。有些陪伴，即使短暂也能产生深远的影响。",
                    relation: "对应项目：【蓝信封书信陪伴】"
                },
                ending_good_teacher: {
                    isEnding: true,
                    title: "【普通结局：合格的引路人】",
                    desc: "你是一位尽职尽责的好老师，帮助学生解决了眼前的问题，获得了大家的认可。你完成了任务，但或许错过了与学生建立更深层次连接的机会。",
                    relation: "通用结局"
                },
                ending_missed_opportunity: {
                    isEnding: true,
                    title: "【遗憾结局：错过的微光】",
                    desc: "你看到了孩子眼中的光，却没能将它留住。教育有时就是与时间赛跑，而坚持信念需要更大的勇气。",
                    relation: "通用结局"
                },
                ending_independent_learner: {
                    isEnding: true,
                    title: "【隐藏结局：授人以渔】",
                    desc: "你成功地教会了他如何自己学习，这是一种更长久的陪伴。真正的教育，是让学生在没有你的时候，依然能自信地探索世界。",
                    relation: "对应项目：【太阳语计划】"
                }
            }
        };

        // --- 游戏状态管理 ---
        let currentSceneId = 'start';
        let playerPath = [];
        let progressSteps = 0;

        // --- DOM 元素获取 ---
        const titleScreen = document.getElementById('title-screen');
        const gameScreen = document.getElementById('game-screen');
        const endingScreen = document.getElementById('ending-screen');
        const sceneContainer = document.getElementById('scene-container');
        const choicesContainer = document.getElementById('choices-container');
        const progressIndicator = document.getElementById('progress-indicator');
        const endingTitle = document.getElementById('ending-title');
        const endingDesc = document.getElementById('ending-desc');
        const endingRelation = document.getElementById('ending-relation');
        const screenshotContainer = document.getElementById('screenshot-container');
        const shareBtn = document.getElementById('share-btn');

        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        // --- 游戏核心函数 ---
        function startGame() {
            titleScreen.classList.add('hidden');
            endingScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            currentSceneId = 'start';
            playerPath = [];
            progressSteps = 0;
            updateProgressIndicator();
            renderScene();
        }

        function updateProgressIndicator() {
            progressSteps++;
            progressIndicator.textContent = `第 ${progressSteps} 阶段`;
        }

        function renderScene() {
            const scene = gameData.scenes[currentSceneId];
            sceneContainer.innerHTML = `<p class="text-gray-700">${scene.text}</p>`;
            choicesContainer.innerHTML = '';

            scene.choices.forEach(choice => {
                const button = document.createElement('button');

                button.className = 'w-full bg-neutral border-2 border-primary hover:bg-primary/10 text-gray-800 text-left py-3 px-4 rounded-lg transition duration-200';
                button.innerHTML = `<i class="fa fa-angle-right text-primary mr-2"></i>${choice.text}`;
                button.onclick = () => makeChoice(choice);
                choicesContainer.appendChild(button);
            });
        }

        function makeChoice(choice) {
            playerPath.push(choice.path);
            currentSceneId = choice.next;
            const nextScene = gameData.scenes[currentSceneId];

            if (nextScene.isEnding) {
                showEnding(nextScene);
            } else {
                updateProgressIndicator();
                renderScene();
            }
        }

        function showEnding(ending) {
            gameScreen.classList.add('hidden');
            endingScreen.classList.remove('hidden');
            endingTitle.textContent = ending.title;
            endingDesc.textContent = ending.desc;
            endingRelation.textContent = ending.relation;
        }

        function restartGame() {
            startGame();
        }

        // 生成并下载分享图片（适配各种移动浏览器）
        function generateShareImage() {
            // 显示加载状态，防止重复点击
            const originalText = shareBtn.innerHTML;
            shareBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i> 生成中...';
            shareBtn.disabled = true;

            // 限制图片容器尺寸，适配移动设备
            const container = document.getElementById('screenshot-container');
            const originalWidth = container.style.maxWidth;
            container.style.maxWidth = '360px';

            html2canvas(container, {
                backgroundColor: null,
                scale: window.devicePixelRatio || 2, // 自适应设备像素比
                useCORS: true,
                logging: false
            }).then(canvas => {
                container.style.maxWidth = originalWidth;

                // 延迟处理确保canvas绘制完成
                setTimeout(() => {
                    try {
                        const dataUrl = canvas.toDataURL('image/png');
                        saveImageOnMobile(dataUrl);

                        // 恢复按钮状态
                        setTimeout(() => {
                            shareBtn.innerHTML = originalText;
                            shareBtn.disabled = false;
                        }, 1000);
                    } catch (err) {
                        handleSaveError(originalText, err);
                    }
                }, 500);
            }).catch(err => {
                handleSaveError(originalText, err);
            });
        }

        // 错误处理函数
        function handleSaveError(originalText, err) {
            console.error('生成图片失败:', err);
            shareBtn.innerHTML = originalText;
            shareBtn.disabled = false;
            alert('保存失败，请尝试截图分享');
        }

        // 适配移动浏览器的图片保存方法
        function saveImageOnMobile(dataUrl) {
            const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
            const isWeChat = /MicroMessenger/.test(navigator.userAgent);

            // 微信浏览器特殊处理（不支持直接下载）
            if (isWeChat) {
                alert('请长按图片选择"保存图片"');
                // 创建临时图片预览
                const tempImg = document.createElement('img');
                tempImg.src = dataUrl;
                tempImg.className = 'fixed top-0 left-0 w-full h-full z-50 object-contain bg-white p-4';
                tempImg.style.boxSizing = 'border-box';
                tempImg.onclick = () => document.body.removeChild(tempImg);
                document.body.appendChild(tempImg);
                return;
            }

            // Safari浏览器处理（需通过新建页面打开）
            if (isSafari) {
                const newTab = window.open();
                newTab.document.write(`<html><head><title>星海引路人-我的结局</title></head><body style="margin:0;"><img src="${dataUrl}" style="max-width:100%;"/></body></html>`);
                newTab.document.close();
                setTimeout(() => {
                    alert('请长按图片选择"保存图片"');
                }, 500);
                return;
            }

            // 通用处理
            const link = document.createElement('a');
            link.download = '星海引路人-我的结局.png';
            link.href = dataUrl;
            link.style.display = 'none';
            document.body.appendChild(link);

            // 模拟触摸点击（适配移动设备）
            const event = new MouseEvent('click', {
                view: window,
                bubbles: true,
                cancelable: true
            });
            link.dispatchEvent(event);

            setTimeout(() => {
                document.body.removeChild(link);
                alert('图片已保存，快去分享到朋友圈吧！');
            }, 1000);
        }

        // --- 事件监听 ---
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', restartGame);
        shareBtn.addEventListener('click', generateShareImage);
    </script>
</body>
</html>